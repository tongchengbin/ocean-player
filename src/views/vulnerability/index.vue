<template>
  <div class="container">
    <div style="margin-top: 30px"></div>
    <el-form inline class="search-form">
      <el-form-item class="search-form-item">
        <el-select placeholder="难度" clearable  @change="getList">
          <el-option label="简单" value="0" key="0"></el-option>
          <el-option label="中等" value="1"></el-option>
          <el-option label="困难" value="2"></el-option>
        </el-select>
      </el-form-item>
      <el-form-item class="search-form-item">
        <el-select v-model="form.status" placeholder="状态" clearable @change="getList">
          <el-option label="未开始" value="0" key="0"></el-option>
          <el-option label="已解答" value="1"></el-option>
        </el-select>
      </el-form-item>
      <el-form-item class="search-form-item">
        <el-input v-model="form.search" placeholder="搜索漏洞名称、编号或内容" @keyup.enter="getList"></el-input>
      </el-form-item>
    </el-form>
    <el-table :data="data" class="custom-table border-bt"  :is-light="false"  row-key="id" :row-class-name="getRowClassName">
      <el-table-column label="名称" prop="name" class-name="border-bt"></el-table-column>
      <el-table-column label="组件" prop="name" class-name="border-bt"></el-table-column>
      <el-table-column label="CVE" class-name="border-bt">
        <template #default="scope" >
          <el-tag  type="" style="display: inline-block" v-for="i in scope.row.cve" :key="i">{{i}}</el-tag>
        </template>
      </el-table-column>
      <el-table-column label="#" class-name="border-bt">
        <template #default="scope">
          <el-button round @click="handleDetail(scope.row)" >详情</el-button>
          <el-button v-if="scope.row.runner.id" round type="warning" @click="handleStop(scope.row)">销毁</el-button>
          <el-button v-else round type="primary" @click="handleStart(scope.row)">启动</el-button>
        </template>
      </el-table-column>
      <el-table-column type="expand" class-name="border-bt">
        <template #default="props">
          <p style="margin-bottom: 0.5rem;">IP:{{props.row.runner.out_ip}}</p>
          <p style="margin-bottom: 0.5rem;">Port:{{props.row.runner.port_info}}</p>
        </template>
      </el-table-column>

    </el-table>


  </div>
</template>

<script>
import request from "@/utils/request";
import {Search} from "@element-plus/icons-vue";
import router from "@/router";
import {ElMessage} from "element-plus";
export default {
  name: "index",
  components: {Search},
  data(){
    return {
      expandKeys:[4,5],
      searchInput:'',
      form:{
        status:'',
        search:''
      },
      data:[]
    }
  },
  created() {
    this.getList()
  },
  methods:{
    getRowClassName({row}) {
      return row.runner.id ? '' : 'no-expand';
    },
    handleDetail(row){
      router.push({"name":'vulnerability.detail',query:{id:row.id}})
    },
    handleStop(row){
      request.post(`/api/vulnerability/${row.id}/stop`).then(res=>{
        ElMessage.success("删除成功")
        this.getList()
      })
    },
    handleStart(row){
      request.post(`/api/vulnerability/${row.id}/start`).then(res=>{
        ElMessage.success("启动成功")
        this.getList()
      }).catch(err=>{})
    },
    getList(){
      request.get('/api/vulnerability',{params:this.form}).then(res=>{
        this.data = res.data
      })
    },
  }
}
</script>

<style scoped lang="less">
.search-form{
  text-align: left;
}
.search-form-item{
  margin-right: 12px;
}
/deep/ .border-bt{
  border-bottom: thin solid rgba(164,177,205,.05)!important;
}
/deep/ .el-select-dropdown{
  background-color: #42b983!important;
}
/deep/ .search >.el-input__inner::placeholder {
  color: rgba(255, 255, 255, 0.5);
}
/deep/ .search >.el-input__inner{
  border-color: #FFFFFF;
  color: #FFFFFF;
  background-color: #04122C;
  box-shadow: 0 0 3px 1px #FFFFFF;
}
/deep/ .search >.el-input__inner:focus{
  border-color: transparent;
  box-shadow: 0 0 3px 1px #FFFFFF;
}
/deep/ .search > .el-input__inner::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

/deep/ .search > .el-input__suffix {
  cursor: pointer;
  color: #FFFFFF;
  border-radius: 0 4px 4px 0;
  padding: 0 10px;
  margin-left: -1px;
  border-left: none;
}




/deep/ .el-table tr:hover>td,/deep/ .el-table tr:focus{
  background-color: #04122C;
}


/deep/ .custom-table .el-table__body {
  color: #FFFFFF;
}

///deep/ .custom-table .el-table__row:hover {
//  background-color: snow;
//}
/deep/ .custom-table td {
  border-bottom: 1px solid rgba(235, 238, 245, 0.38);
}
/deep/ .custom-table table {
  border-bottom: 1px solid rgba(235, 238, 245, 0.38);
}
/deep/ .custom-table .el-table__footer-wrapper {
  display: none;
}
/deep/ .no-expand  .el-table__expand-icon{
  display: none;
}
</style>